/*
Malware Detection Rules for Digital Security Toolkit
*/

rule ransomware_indicators {
    meta:
        description = "Detects potential ransomware indicators"
        author = "Digital Security Toolkit"
        date = "2024-01-01"
        severity = "high"
    
    strings:
        $class = "class" nocase
    
    condition:
        $class
}


rule suspicious_execution_tools
{
    meta:
        description = "Detects use of Windows tools commonly abused by malware"
        author = "Digital Security Toolkit"
        severity = "high"

    strings:
        $cmd = "cmd.exe" nocase
        $ps = "powershell.exe" nocase
        $wscript = "wscript.exe" nocase
        $cscript = "cscript.exe" nocase

    condition:
        any of them
}

rule obfuscated_powershell
{
    meta:
        description = "Detects common obfuscation patterns in PowerShell scripts"
        author = "Digital Security Toolkit"
        severity = "medium"

    strings:
        $base64_flag = "-enc" nocase
        $frombase64 = "FromBase64String" nocase
        $hidden = "-windowstyle hidden" nocase
        $bypass = "ExecutionPolicy Bypass" nocase

    condition:
        2 of them
}

rule suspicious_api_usage
{
    meta:
        description = "Detects suspicious Windows API calls often used in injection techniques"
        author = "Digital Security Toolkit"
        severity = "high"

    strings:
        $vAlloc = "VirtualAlloc" nocase
        $wPM = "WriteProcessMemory" nocase
        $cRemote = "CreateRemoteThread" nocase
        $gProc = "GetProcAddress" nocase
        $lLib = "LoadLibraryA" nocase

    condition:
        3 of them
}

rule upx_packed
{
    meta:
        description = "Detects binaries packed with UPX"
        author = "Digital Security Toolkit"
        severity = "low"

    strings:
        $upx1 = "UPX0"
        $upx2 = "UPX1"
        $upx3 = "UPX2"
        $marker = "This file is packed with the UPX executable packer"

    condition:
        any of ($upx*) or $marker
}

rule reverse_shell_strings
{
    meta:
        description = "Detects common strings found in reverse shells"
        author = "Digital Security Toolkit"
        severity = "high"

    strings:
        $rev1 = "socket(AF_INET" ascii
        $rev2 = "connect(" ascii
        $rev3 = "/bin/sh" ascii
        $rev4 = "cmd.exe" ascii

    condition:
        $rev1 and $rev2 and ($rev3 or $rev4)
}


